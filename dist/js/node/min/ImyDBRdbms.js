!function(t){"use strict";var e=require("./lib/ImyDBBase.js").ImyDBBase,n=require("knex"),r=require("./param/ImyDBKnex.param.js").ImyDBKnex,a=require("./lib/util.js").util,o=require("./param/ERROR.js").ERROR,i=function(t){e.call(this,t)};i._name_="ImyDBRdbms",i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!0,writable:!1,configurable:!0}}),i.prototype.open=function(){return new Promise(function(){return!0})},i.prototype.close=function(){return console.log(this.db.destroy),this.db.destroy()},i.prototype.useConfig=function(t){this.db=n(t)},i.prototype.transaction=function(t){var e=this;return this.db.transaction(function(n){e.trx=n,t()}).then(function(){e.trx=null})["catch"](function(){e.trx=null})},i.prototype.commit=function(){null!==this.trx?this.trx.commit():o.no_transaction("commit")},i.prototype.rollback=function(){null!==this.trx?this.trx.rollback():o.no_transaction("rollback")},i.prototype.getAllIndexFragments=function(){var t=r.fr.select.all(this._getInstance());return this._doDebugging({name:"getAllIndexFragments",query:t}),t},i.prototype.getIndexFragmentIdForTypeAndValue=function(t,e){var n=r.fr.select["id.for_type_value"](this._getInstance(),{type:a._string(t),value:a._string(e)});return this._doDebugging({name:"getIndexFragmentIdForTypeAndValue",query:n}),n.then(function(t){return t[0]?t[0].id:null})},i.prototype.addIndexFragment=function(t,e){var n=r.fr.insert(this._getInstance(),{type:a._string(t),value:a._string(e)});return this._doDebugging({name:"addIndexFragment",query:n}),n},i.prototype.removeIndexFragments=function(t,e){var n=r.fr["delete"].for_type_value(this._getInstance(),{type:a._string(t),value:a._string(e)});return this._doDebugging({name:"removeIndexFragments",query:n}),n},i.prototype.truncateIndexFragments=function(){var t=r.fr["delete"].all(this._getInstance());return this._doDebugging({name:"truncateIndexFragments",query:t}),t},i.prototype.getAllIndexParameters=function(){var t=r.pa.select.all(this._getInstance());return this._doDebugging({name:"getAllIndexParameters",query:t}),t},i.prototype.addIndexParameter=function(t,e,n,o,i,u,s){var g=r.pa.insert(this._getInstance(),{type:a._string(t),idx_fragment_id:a._double(e),data_id:a._double(n),content_pos1:a._int(o),content_pos2:a._int(i),sort_flag:a._int(u),skip:a._int(s)});return this._doDebugging({name:"addIndexParameter",query:g}),g},i.prototype.removeIndexParameters=function(t){var e=r.pa["delete"].for_dataid(this._getInstance(),{data_id:a._double(t)});return this._doDebugging({name:"removeIndexParameter",query:e}),e},i.prototype.countIndexParametersOfFragment=function(t,e){var n=r.count["parametered_fragment.for_type_value"](this._getInstance(),{type:a._string(t),value:a._string(e)});return this._doDebugging({name:"countIndexParametersOfFragment",query:n}),n.then(function(t){return t[0]?t[0][Object.keys(t[0])[0]]:0})},i.prototype.truncateIndexParameters=function(){var t=r.pa["delete"].all(this._getInstance());return this._doDebugging({name:"truncateIndexParameters",query:t}),t},i.prototype.getAllData=function(){var t=r.da.select["all.for"](this._getInstance());return this._doDebugging({name:"getAllData",query:t}),t},i.prototype.getDataForTypeAndContent=function(t,e){var n=r.da.select["all.for"](this._getInstance(),{type:a._string(t),content:a._string(e)});return this._doDebugging({name:"getDataForTypeAndContent",query:n}),n},i.prototype.getDatumForId=function(t){var e=r.da.select["all.for"](this._getInstance(),{id:a._double(t)});return this._doDebugging({name:"getDatumForId",query:e}),e},i.prototype.addDatum=function(t,e){var n=r.da.insert(this._getInstance(),{type:a._string(t),content:a._string(e)});return this._doDebugging({name:"addDatum",query:n}),n},i.prototype.removeData=function(t){var e=r.da["delete"]["for"](this._getInstance(),{id:a._double(t)});return this._doDebugging({name:"removeData",query:e}),e},i.prototype.updateData=function(t,e){var n=r.da.update["for"](this._getInstance(),{type:a._string(t.type),content:a._string(t.content)},{id:a._double(e.id),type:a._double(e.type),content:a._double(e.type)});return this._doDebugging({name:"updateData",query:n}),n},i.prototype.truncateData=function(){var t=r.da["delete"].all(this._getInstance());return this._doDebugging({name:"truncateData",query:t}),t},i.prototype.getForTypeAndValues=function(t,e){var n=r.search["parametered_fragment.for_type_values"](this._getInstance(),{type:a._string(t),values:e});return this._doDebugging({name:"getForTypeAndValues",query:n}),n},t.ImyDBRdbms=i}(this);